# 2018.10.29 TIL## BBGame### Item```using System.Collections;using System.Collections.Generic;using UnityEngine;public class Item : MonoBehaviour {	public enum ItemNum {SPEED, LONG, DWARF };	public ItemNum state;	// Use this for initialization	void Start () {	}		// Update is called once per frame	void Update () {		if(BBGameManager.Instance.isPlaying)			this.transform.position -= new Vector3(0, 0.01f, 0);	}	private void OnCollisionEnter2D(Collision2D collision)	{		if(collision.transform.tag == "Bar")		{			if (state == ItemNum.SPEED)			{				Bar.Instance.speed += 0.3f;			}			else if (state == ItemNum.LONG)			{				Bar.Instance.transform.localScale += new Vector3(Bar.Instance.transform.localScale.x*0.1f, 0, 0);			}			else if (state == ItemNum.DWARF)			{				Bar.Instance.transform.localScale -= new Vector3(Bar.Instance.transform.localScale.x * 0.1f, 0, 0);			}			GameObject.Destroy(this.gameObject);		}		else if(collision.transform.tag == "GameOverLine")		{			GameObject.Destroy(this.gameObject);		}	}}```1. Item의 state는 세가지로, Bar의 speed를 빠르게 하는 FAST, Bar의 크기를 길게하는 Long, 짧게하는 Short가 있다.2. Item의 state는 Brick이 깨지면서 생성 될 때에 정해진다.3. item은 조금씩 내려오는 방향성을 지닌다. Bar와 충돌할 시 효과가 발생하고, GameOverLine에 부딪힐 시 Destroy된다.### Brick (item 생성 코드)```using System.Collections;using System.Collections.Generic;using UnityEngine;public class Brick : MonoBehaviour {	public GameObject SpeedItemOrigin;	public GameObject LongItemOrigin;	public GameObject DwarfItemOrigin;	// Use this for initialization	void Start () {			}		// Update is called once per frame	void Update () {	}	public void OnCollisionEnter2D(Collision2D collision)	{		if (collision.transform.tag == "Ball")		{			int a = Random.Range(0, 10);			if (a == 0)			{				Item item = GameObject.Instantiate(SpeedItemOrigin).GetComponent<Item>();				item.transform.position = this.transform.position;				item.state = Item.ItemNum.FAST;				item.gameObject.SetActive(true);			}			else if (a == 1)			{				Item item = GameObject.Instantiate(LongItemOrigin).GetComponent<Item>();				item.transform.position = this.transform.position;				item.state = Item.ItemNum.LONG;				item.gameObject.SetActive(true);			}			else if (a == 2)			{				Item item = GameObject.Instantiate(DwarfItemOrigin).GetComponent<Item>();				item.transform.position = this.transform.position;				item.state = Item.ItemNum.SHORT;				item.gameObject.SetActive(true);			}			BBGameManager.Instance.score += 1;			GameObject.Destroy(this.gameObject);			BBMapManager.Instance.brickNum -= 1;		}	}}```1. ball과 부딪힐 시에 Random하게 아이템3종중 하나를 드랍하거나 드랍하지 않는다. (각 아이템 드랍률은 10프로이다.)2. 확률에 따라 각 아이템이 생성될 시에 위치와 state가 초기화되고, 비활성화되어있던 gameObject item이 활성화 된다.### Layer끼리의 상호작용1. UI와 Game 레이어를 처음부터 따로 만들어야 한다. 2. 만약 하나의 레이어에 존재한다면 collider가 서로 간섭하여 충돌체크를 할 수 있다.3. 이를 해결하기 위해서, UI와 Game레이어를 분리하고, Edit - Project settings - phisics의 Layer Collision Matrix에서 체크를 해제하면 된다.4. 이때 중요한건, 레이어를 새로 생성하였을 때 Main camera가 culling Mask 가 체크 해제 되어있을 수 있으니 반드시 체크하여야 Game화면에 보인다.### Collision1. 두 gameObject에 collider가 붙어있어도, 둘중 하나에 rigidbody가 없다면 충돌체크는 일어나지 않는다.2. 두 gameOBject에 collider가 붙어있고 둘중하나에 rigidbody가 붙어있을 경우, rigidbody가 붙어있는 gameObject와 그렇지 않은 gameObject가 겹칠 시, rigidbody가 붙어있는 gameObject가 밀려버리는 현상이 발생한다. (이를 어떻게 해결해야 할까...?)3. 두 gameObject에 collider와 rigidbody가 붙으면, Unity 자체의 물리엔진을 사용하기 용이하겠지만, 손으로 코딩할 경우에는 왜곡현상이 발생한다.....### 내일 해야할 일1. 세개의 게임 합치기2. resource 다듬기3. UI Popup의 문제 해결하기4. collider 오류 해결하기