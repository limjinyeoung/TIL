﻿﻿﻿# 2018.09.11 TIL## CRT Script 분석### BlockObejct Script - Code : blockObejct의 고유 번호. MapPrefebs에서 중복을 체크할 때 쓰인다. - BlockIndex : MapPrefebs나 MapManager에서 block Index를 체크할 때 쓰인다. (Start인지, Middle인지. 보통 MapObject의 enum으로 열거된 정의와 함께 쓰인다.start, middle, finish, subtile, end) - UnitState : block의 상태(NoUnit, Car, Train, Boat, End등)를 나타낸다. MapObejct의 enum과 함께 쓰인다.  - [Space] 가 무엇이지..?### MapObject Script - OriginVerticalIndex : 아직 쓰이지 않음 - UnitState : Line에 나타날 도로 모양.(Line에 나타날 Unit의 종류) - speed : Line의 Unit의 속도 - Reverse : Line의 방향을 결정짓는 bool - time : unit 생성 시기를 조절하기 위해 time을 세고, 일정 값을 넘어가면 초기화하고 다시 세는 것을 반복. - TileObejcts : GameObject의 List.  - Start() : 50%의 확률로, Line의 방향이 반대로 흘러가게 하며, TileObjects를 초기화. UnitState에 따라서 Unit(car, train등)의속도 지정. time을 0.5~1.5사이로 랜덤하게 지정. foreach문을 통하여 TileObjects에 transform의 GameObject를 add. (foreach(Transform trans in this.transform)은 뭘 의미하는걸까...?) - SetDisplay(bool display) : foreach문을 이용하여, TileObjects의 모든 gameObject들을 활성화(혹은 비활성화)시킴. - Update() : 만약에 UnitState가 Car나 Train이 아니라면 return. 그렇지 않다면 다음을 수행한다. time을 세기 시작하며, unitState가 car라면 generatTime을 2.5와 4 사이의 랜덤값으로 정하고, train이라면 7과 12사이의 랜덤값으로 정한다. 이 때, time이 generateTime에 다다르면, time을 초기화하는 동시에 Unit를 Generate한다. - GenerateUnit() : UnitPrefabs의 Instance중 하나를 랜덤하게 골라 unit로 지정하고, (만약 unit이 비어있다면 return) Reverse에 따라서 Speed와 Position, Rotation을 정한 후, unit이 맵 끝에 다다른 시간에 Destroy되도록 Destroy(unit.gameObject, MapManager.Instance.MapHorizontalCount*15 / speed);를 한다.### Player Script - Direction : 방향을 enum으로 정의한다.(Left부터 시계방향으로 0~3) - direction : enum인 Direction의 형식. - destination : 벡터....? - Start() : Destination을 현재 player의 position으로 초기화 - Position : 현재의 gameObject의 position을 set하고, 그것을 get함. 왜 이런 코드가 필요한걸까...? - SetDirection(Direction direction) : direction과 rotation을 초기화한 수치에서, direction에 따라 rotation을 고치고, Destination을 설정한다. - Update() : Destination에 따라 Position이 부드럽게 이동하도록 한다.## CRT ### UIManager script와 scoreLabel```using System.Collections;using System.Collections.Generic;using UnityEngine;public class UIManager : MonoBehaviour {	public UILabel meterLabel;	public UILabel timeLabel;	private float time;		void Start () {		time = 0;	}		void Update () {		time += Time.deltaTime;		if (time >= 1)		{			timeLabel.text = (int.Parse(timeLabel.text) + 1).ToString();			time -= 1;		}	}	public void setMeter(int i)	{		meterLabel.text = (int.Parse(meterLabel.text) + i).ToString();	}}```1. UI Label로 MeterLabel과 TimeLabel을 만들어 public으로 지정해두어야함2. MeterLabel은 PlayerManager script에서 setMeter(1)또는 setMeter(-1)로 접근하여 수정되며(이때 PlayerManager에서 public으로 UIManager를 가지고있는 UIRoot를 참조하도록(?) 한다.), TimeLabel은 시간의 경과에 따라 UIManager script의 Update()에서 수정된다. 3. UI모양에 신경쓰지 않고 글자만 나타나도록 하며, Anchors를 Unified로, Target의 왼쪽, 오른쪽, 위, 아래를 기준으로 잡아야 위치가 왜곡되지 않는다.### 시간에 따른 차의 속도 조절1. 차 속도는 차 object의 속도 하나하나를 수정하는 것이 아니라, Line마다 차의 속도를 지정한다. 2. Line의 speed는 처음 Line이 생성될 때 정해지는데, Line script의 Start()에서 정해진다. 따라서 Start()가 아닌 GenerateUnit() 메소드에서  car unit을 생성할 때에 speed에 (stime + 100)/100을 곱하는 방식으로 스피드를 수정한다.3. 이 방법 외에, Line을 생성하는 MapManager에서 시간을 계산하여 Line 생성시 참조변수로 보내는 방법도 있다.(그러나 어려울듯하다)