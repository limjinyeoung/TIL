﻿﻿﻿#2018.09.12 TIL## CRT### Button1. ResetButton과 PauseButton은 둘다 비슷한형식이므로, 후에 Duplicate할 수 있다.2. 시작하기전에, UI의 위치를 고정하기 위해 UI Root의 script에서 Scaling Style을 Constrained On Mobiles로 지정한다!별다섯개3. Button은 NGUI의 Sprite로 만든다. UI Sprite에 UI Button script와 Box collider component를 add한 후, UI Sprite(script) widget의 Collider를 auto-adjust to match를 체크하여 box collider가 sprite와 자동으로 조정되게끔 한다.4. 위치와 크기를 target에 맞춰 조절하는 Anchors는 사용하지 않고, (UI Root의 Scaling style이 이미 맞춰졌기 때문에) 간단하게 x,y의 위치만 수정하여 위치를 만든다.5. UI Sprite의 Atlas와 Sprite는 이미 있는 Wooden Atlas의 Window(부드러운 사각형모양)를 사용하고, Gradient를 이용하여 색갈을 입힌다.6. 버튼 위에 버튼의 이름( Re, II)을 적기 위해, Sprite의 하위 UI로 Label을 생성하여 적는다.7. UI Button Script의 On Click의 Notify는 GameManager로 정하고, Method는 public으로 된 OnButtonListener를 직접 만들어 지정한다.### Popup - Popup Panel을 생성한 후, BackBoard(Sprite)와 ResumeButton, ResetButton을 생성한다.(버튼은 InGame Panel의 버튼을 복붙.) 단, 모두Depth가 Ingame의 오브젝트들보다 앞으로 나오게 해야한다. - Panel 자체는 활성화하되, Panel의 Alpha값은 0으로 둔다. Tween Alpha component를 add하여 비활성화시켜둔다.(후에 true로 처리한 후 script에서 play하도록 한다.) - BackBoard의 Sprite는 Button으로, ColorTint는 검은색이되 alpha를 반투명하게 한다. (Depth는 popup 의 버튼들보다 깊게.)### GameManager Script```using System.Collections;using System.Collections.Generic;using UnityEngine;using UnityEngine.SceneManagement;public class GameManager : MonoBehaviour {	public static GameManager Instance { get; private set; }	public bool isPlaying = true;	// Use this for initialization	void Start () {		Instance = this;	}		// Update is called once per frame	void Update () {			}	public void switchPlayStatus()	{		if (isPlaying)		{			isPlaying = false;			Time.timeScale = 0;			UIManager.Instance.SetPopUpEnable();		}		else		{			isPlaying = true;			Time.timeScale = 1;			UIManager.Instance.SetPopUpUnable();		}	}	public void ResetGame()	{		SceneManager.LoadScene(SceneManager.GetActiveScene().name);		Time.timeScale = 1;	}}``` - Instance를 생성하여 외부 script가 접근하기 용이하도록 한다. (다른 script들에서 게임의 상태를 알아오기 위해 자주 쓰인다.) - isPlaying은 Pause의 기능을 원활히 하기 위해 만든 변수이다. - SwitchPlayStatus() : UIManager에서 주로 호출하는 함수로, Play상태라면 멈추고, pause상태라면 플레이하도록 한다(timeScale을 조절하여 가능). 이 때, Popup창의 변화도 함께 일어나기 때문에, UIManager의 SetPopUp~~을 호출한다. - ResetGame() : SceneManager를 통해 아예 씬을 리셋한다. 이 때, timeScale을 원래대로 되돌려놓는다.### UIManager Script```using System.Collections;using System.Collections.Generic;using UnityEngine;public class UIManager : MonoBehaviour {	public static UIManager Instance { get; private set; }	public UILabel meterLabel;	public UILabel timeLabel;	public TweenAlpha popup;	private float time;		void Start () {		Instance = this;		time = 0;	}		void Update () {		time += Time.deltaTime;		if (time >= 1)		{			timeLabel.text = (int.Parse(timeLabel.text) + 1).ToString();			time -= 1;		}	}	public void setMeter(int i)	{		meterLabel.text = (int.Parse(meterLabel.text) + i).ToString();	}	public void SetPopUpEnable()	{		popup.enabled = true;		popup.PlayForward();	}	public void SetPopUpUnable()	{		popup.PlayReverse();	}	public void OnResetButtonListener()	{		GameManager.Instance.ResetGame();	}	public void OnPauseButtonListener()	{		GameManager.Instance.switchPlayStatus();	}}``` - Instance를 생성하여 외부 script가 접근하기 용이하도록 한다. (주로 GameManager가 접근함) - UI에서 수치가 변하는 Label들을 관리하며, Popup창을 껐다 켜는 TweenAlpha기능도 관리한다. - time은 플레이 시간(1초 이하)을 의미하며, update시 증가하고, 1초가 넘으면 timeLabel을 수정하고 1을 깎는 방식으로 플레이시간을 나타낼 수 있게 한다. - setMeter(int i) : 외부 스크립트에서 수정하는데, meterLabel의 수치를 받아와 더하거나 빼어서 다시 입력하는 방식이다. - SetPopUpEnable() : popup창이 활성화되도록하고, TweenAlpha애니메이션이 재생되도록한다. (Alpha값이 0->1) - SetPopUpUnable() : popup창의 TweenAlpha애니메이션을 역재생하여 popup창을 비활성화시킨다. - OnResetButtonListener와 OnPauseButtonListener는 두 종류버튼의 Notice 함수로 설정하여 버튼이 클릭되었음을 감지하고 GameManager에 접근하여 Reset또는 Pause(=switchPlayStatus)를 실행한다.## CRT script 분석### MapObject Script - UnitState : unit의 종류 enum (차, 기차 등) - BlockIndex : BlockObject의 index (연속된 도로형식의 처음중간끝index)